{"version":3,"sources":["../../src/commands/url.ts"],"names":["logArtifactUrl","platform","projectDir","options","publicUrl","UrlUtils","isHttps","CommandError","res","process","env","EXPO_LEGACY_API","Project","buildAsync","current","mode","getBuildStatusAsync","url","jobs","filter","job","artifacts","log","nested","Error","getWebAppUrlAsync","webAppUrl","constructWebAppUrlAsync","action","urlOpts","optsAsync","currentStatus","web","constructManifestUrlAsync","newLine","printQRCode","chalk","underline","handleMobileOptsAsync","program","command","alias","option","description","allowOffline","asyncActionProjectDir"],"mappings":"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","sourcesContent":["import { Command } from 'commander';\nimport chalk from 'chalk';\nimport { Project, UrlUtils } from '@expo/xdl';\n\nimport CommandError from '../CommandError';\nimport log from '../log';\nimport urlOpts, { URLOptions } from '../urlOpts';\nimport printRunInstructionsAsync from '../printRunInstructionsAsync';\n\ntype ProjectUrlOptions = Command & {\n  web?: boolean;\n};\n\ntype ArtifactUrlOptions = {\n  publicUrl?: string;\n};\n\nconst logArtifactUrl = (platform: 'ios' | 'android') => async (\n  projectDir: string,\n  options: ArtifactUrlOptions\n) => {\n  if (options.publicUrl && !UrlUtils.isHttps(options.publicUrl)) {\n    throw new CommandError('INVALID_PUBLIC_URL', '--public-url must be a valid HTTPS URL.');\n  }\n\n  let res;\n  if (process.env.EXPO_LEGACY_API === 'true') {\n    res = (await Project.buildAsync(projectDir, {\n      current: false,\n      mode: 'status',\n      ...(options.publicUrl ? { publicUrl: options.publicUrl } : {}),\n    })) as Project.BuildStatusResult;\n  } else {\n    res = await Project.getBuildStatusAsync(projectDir, {\n      current: false,\n      ...(options.publicUrl ? { publicUrl: options.publicUrl } : {}),\n    });\n  }\n  const url = res.jobs?.filter((job: Project.BuildJobFields) => job.platform === platform)[0]\n    ?.artifacts?.url;\n  if (url) {\n    log.nested(url);\n  } else {\n    throw new Error(\n      `No ${platform} binary file found. Use \"expo build:${platform}\" to create one.`\n    );\n  }\n};\n\nasync function getWebAppUrlAsync(projectDir: string): Promise<string> {\n  const webAppUrl = await UrlUtils.constructWebAppUrlAsync(projectDir);\n  if (!webAppUrl) {\n    throw new CommandError(\n      'NOT_RUNNING',\n      `Expo web server is not running. Please start it with \\`expo start:web\\`.`\n    );\n  }\n  return webAppUrl;\n}\n\nasync function action(projectDir: string, options: ProjectUrlOptions & URLOptions) {\n  await urlOpts.optsAsync(projectDir, options);\n\n  if ((await Project.currentStatus(projectDir)) !== 'running') {\n    throw new CommandError(\n      'NOT_RUNNING',\n      `Project is not running. Please start it with \\`expo start\\`.`\n    );\n  }\n  const url = options.web\n    ? await getWebAppUrlAsync(projectDir)\n    : await UrlUtils.constructManifestUrlAsync(projectDir);\n\n  log.newLine();\n  urlOpts.printQRCode(url);\n\n  log('Your URL is\\n\\n' + chalk.underline(url) + '\\n');\n\n  if (!options.web) {\n    await printRunInstructionsAsync();\n    await urlOpts.handleMobileOptsAsync(projectDir, options);\n  }\n}\n\nexport default function(program: Command) {\n  program\n    .command('url [project-dir]')\n    .alias('u')\n    .option('-w, --web', 'Return the URL of the web app')\n    .description('Displays the URL you can use to view your project in Expo')\n    .urlOpts()\n    .allowOffline()\n    .asyncActionProjectDir(action);\n\n  program\n    .command('url:ipa [project-dir]')\n    .option('--public-url <url>', 'The URL of an externally hosted manifest (for self-hosted apps)')\n    .description('Displays the standalone iOS binary URL you can use to download your app binary')\n    .asyncActionProjectDir(logArtifactUrl('ios'));\n\n  program\n    .command('url:apk [project-dir]')\n    .option('--public-url <url>', 'The URL of an externally hosted manifest (for self-hosted apps)')\n    .description(\n      'Displays the standalone Android binary URL you can use to download your app binary'\n    )\n    .asyncActionProjectDir(logArtifactUrl('android'));\n}\n"],"file":"url.js"}